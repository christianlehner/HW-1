---
title: "MATH 216 Homework 1"
author: "Christian Michael Lehner"
output: html_document
---

```{r, echo=FALSE, message=FALSE}
# DO NOT EDIT THIS SECTION
# Load packages
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(lubridate))
```
```{r, echo=FALSE, message=FALSE, cache=TRUE}
# Load data sets. Note this assumes this .Rmd files is in the same directory as
# the .csv files.
flights <- read.csv("data/flights.csv", stringsAsFactors = FALSE) %>% 
 tbl_df() %>%
 mutate(date=as.Date(date))
weather <- read.csv("data/weather.csv", stringsAsFactors = FALSE) %>% 
 tbl_df() %>%
 mutate(date=as.Date(date))
planes <- read.csv("data/planes.csv", stringsAsFactors = FALSE) %>% 
 tbl_df()
airports <- read.csv("data/airports.csv", stringsAsFactors = FALSE) %>% 
 tbl_df()
states <- read.csv("data/states.csv", stringsAsFactors = FALSE) %>% 
 tbl_df()
```






## Admistrative:

Please indicate

* Who you collaborated with: Delaney and others...I will find their names
* Roughly how much time you spent on this HW: 4 hours conservatively but dramtically more effecient at the end
* What gave you the most trouble: the first question
* Any comments you have: ggplot2 has been around for a while there are so many helpful websites: I have been up past 3 the last
4 nights so I am barely human so this is definitely a draft




## Question 1:

* Plot a "time series" of the proportion of flights that were delayed by > 30 minutes on each day.  i.e.
    + the x-axis should be some notion of time
    + the y-axis should be the proportion.
* Which seasons did we tend to see the most and least delays of > 30 minutes.

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}
seasons <- filter(flights, dep_delay > 30) %>% 
  mutate(month = months(date)) %>%
  group_by(month) %>% 
  tally() %>% 
  rename(delays = n) %>%
  mutate(prop = delays/sum(delays))

sum(seasons$delays)
sum(seasons$prop)
seasons

plot <- ggplot(data=seasons, aes(x=month, y=prop)) + 
  ggtitle("Proportion of Total Yearly Delays by Month") + geom_bar(stat="identity")
plot
```





## Question 2:

Some people prefer flying on older planes.  Even though they aren't as nice,
they tend to have more room.  Which airlines should these people favor?

```{r, echo=FALSE, fig.width=12, fig.height=6}
oldplanes <- left_join(planes, flights, by = "plane") %>% 
             select(carrier, plane, year) %>% 
             distinct(plane) 

propold <-   filter(oldplanes, year < 1980) %>% 
            group_by(carrier) %>% 
            tally() %>% 
            rename(old = n) %>%
            mutate(prop = old/sum(old))

sum(propold$old)
sum(propold$prop)

ggplot(data=propold, aes(x=carrier, y=prop)) +
  geom_bar(stat="identity") + ggtitle("Proportion of 1980 and Earlier Planes by Carrier")
```







## Question 3:

* What states did listed Southwest Airlines flights tend to fly to?
* What states did all Southwest Airlines flights tend to fly to?


```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}
library(grid)
airports <- airports %>% rename(dest = iata)

swdest <- inner_join(flights, airports, by = "dest") %>% 
  select(state, dest, carrier, flight) %>% 
  filter(carrier == "WN") %>% 
  group_by(state) %>% 
  tally() %>% 
  rename(swflights = n)
a <- ggplot(data=swdest, aes(x=state, y=swflights)) + geom_bar(stat="identity") 
a + ggtitle("All SW Flights by Occurence")

swdest2 <- inner_join(flights, airports, by = "dest") %>%
          filter(carrier == "WN") %>% 
          select(state, dest, carrier, flight) %>% 
          distinct(flight) %>% 
          group_by(state) %>% 
          tally() %>% 
          rename(swflights2 = n)

p <- ggplot(data=swdest2, aes(x=state, y=swflights2)) + geom_bar(stat="identity") 
p + ggtitle("Specific Flight Paths by State")

```





## Question 4:

What weather patterns are associated with the biggest departure delays?

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}
patterns <- left_join(flights, weather, by = "date") %>%
            group_by(conditions) %>% 
            tally() %>% 
            rename(total = n) 

patterns2 <-  left_join(flights, weather, by = "date") %>%
              filter(dep_delay > 40) %>%
              group_by(conditions) %>% 
              tally() %>% 
              rename(delays = n)

patterns3 <- left_join(patterns, patterns2, by =  "conditions") %>%
              mutate(proportion = delays/total)
patterns3
ggplot(data=patterns3, aes(x=conditions, y=proportion)) +
  geom_bar(stat="identity") + ggtitle("Probility of Delay by Conditions") + coord_flip()         
```





## Question 5:

I want to know what proportionately regions (NE, south, west, midwest) each 
carrier flies to from Houston in the month of July.  Consider the `month()`
function from the `lubridate` package.

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}
julydest <- left_join(flights, airports, by = "dest") %>% 
  mutate(month = months(date)) %>%
  filter(month == "July") 
july <- left_join(julydest, states, by = "state") %>% 
        select(region, carrier, flight) %>% 
        group_by(region) %>% 
        tally() %>% 
        rename(total = n) %>% 
        mutate(prop = total/sum(total))
plotregion <- ggplot(data=july, aes(x=region, y=prop)) + 
  ggtitle("Proportion of Houston Flights in July US Regions") + geom_bar(stat="identity")
plotregion
```
